function mainPageLogic(){function a(){document.hidden?e=!1:(e=!0,f=0,document.title="ChangeDJ")}function b(a){$(".djQueue ul").empty(),0!=a.length?($(".noDJ").hide(),$(".djQueue ul").show()):($(".djQueue ul").hide(),$(".noDJ").show());for(var b=0;b<a.length;b++)$(".djQueue ul").append("<li>"+a[b].username+"</li>")}function c(a){var b=encodeURIComponent(a).replace(/%20/g,"+");$.ajax({method:"GET",url:"https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&order=relevance&type=video&q="+b+"&videoSyndicated=true&videoEmbeddable=true&key=AIzaSyBRtVVHPmgkcUe36EUdHN-yWetm7-IjIO0"}).done(function(a){for(var b=0;b<a.items.length;b++)g.push(a.items[b].id.videoId),h.push(a.items[b].snippet.thumbnails["default"].url),$(".songSearches").append('<div class="searchedVideoDiv"><div class="addSongToPlaylist btn">+</div><img src="'+a.items[b].snippet.thumbnails["default"].url+'" class="centerSearchIMG"/><div class="clearfix"></div><span class="searchedVideoTitle">'+a.items[b].snippet.title+"</span></div>")})}function d(a){if($(".playlistContent").empty(),0==a.length)$(".playlistContent").text("You currently have no songs in your playlist."),$(".djBtn").hide(),socket.emit("leave dj",userInfo.username),socket.emit("dj queue");else{$(".joinDJ").is(":visible")||$(".leaveDJ").is(":visible")||$(".joinDJ").show(),userPlaylist=a,$(".playlistContent").append('<ul class="playlistContentList"></ul>');for(var b=0,c=0;c<userPlaylist.length;c++)$(".playlistContentList").append('<li class="playlistContentListItem searchedVideoDiv"><div class="moveSongToFirst option" id="moveSongToFirst'+b+'">&#8593;</div><button class="removeSongBtn redBtn" id="removeSongBtn'+b+'">-</button><img src="'+userPlaylist[c].imgurl+'" class="playlistIMG"/><br><span class="playlistSongName">'+userPlaylist[c].songname+"</span></li>"),$("#removeSongBtn"+b).data("songid",userPlaylist[c].songid),$("#moveSongToFirst"+b).data("song",userPlaylist[c]),b++;$(".moveSongToFirst").hide()}}socket=io(),$.getScript("/scripts/youtube.min.js").done(function(){$(window).width()<850&&$(".mainOptionsBtn").css({width:"99%","float":"none"}),$(".chatMessages").css({"max-height":$(window).height()/6.5}),$(".djQueue ul").css({"max-height":$(window).height()/2}),$(".songSearches").css({"max-height":$(window).height()/2.2}),$(".playlistContent").css({"max-height":$(window).height()/1.8})}),window.onbeforeunload=function(){socket.emit("leave dj",userInfo.username),socket.emit("dj queue"),socket.emit("leave userlist",userInfo.username)},$.ajax({method:"GET",url:"/userinfo"}).done(function(a){userInfo=a;var c={username:userInfo.username};$.ajax({method:"POST",url:"/getuserplaylist",data:c}).done(function(a){d(a),$.ajax({method:"GET",url:"/djqueue"}).done(function(a){b(a),socket.emit("join userlist",userInfo.username)})})}),$("body").on("click",".dropdown",function(){$(".dropdownList").is(":visible")?$(".dropdownList").hide():$(".dropdownList").css("display","block")}),$("body").on("click",".mainContainer",function(){$(".dropdownList").is(":visible")&&$(".dropdownList").hide()}),$("body").on("click",".chatCodes",function(){alert("This currently does nothing")}),$(".userListContainer").draggable({handle:".userListHeader",containment:"document"}),$("body").on("click",".userList",function(){socket.emit("get userlist")}),socket.on("get userlist",function(a){$(".userListList").empty();for(var b=0;b<a.length;b++)$(".userListList").append("<li>"+a[b]+"</li>");$(".userListContainer").show()}),$("body").on("click",".exitBtn",function(){$(this).parent().parent().hide()}),$("body").on("click",".plBtn",function(){$(this).hasClass("redBtn")||($(this).addClass("redBtn"),$(".asBtn").removeClass("redBtn"),$(".playlistContent").show(),$(".addSongContent").hide())}),$("body").on("click",".asBtn",function(){$(this).hasClass("redBtn")||($(this).addClass("redBtn"),$(".plBtn").removeClass("redBtn"),$(".playlistContent").hide(),$(".addSongContent").show(),$(".searchInput").focus())});var e,f=0;document.addEventListener("visibilitychange",a,!1),$(".chatInput").on("keyup",function(a){if(a.preventDefault(),13==a.which)if($(this).val().match(/^\s*$/))alert("Message cannot be blank");else if($(this).val().length>200)alert("200 character limit");else if($(this).val().startsWith("img:")){var b=$(this).val().replace("img:","");if(b.endsWith(".gif")){var c='<img src="'+b+'" class="chatImg"/>',d={userId:userInfo.username,msg:c};socket.emit("user chat message",d),$(this).val("")}else alert("Invalid .gif url")}else{var c=$(this).val().replace(/[^a-z0-9]/gi," "),d={userId:userInfo.username,msg:c};socket.emit("user chat message",d),$(this).val("")}}),socket.on("user chat message",function(a){$(".chatMessages ul").append('<li><span style="color: '+a.color+';">'+a.userId+"</span>: "+a.msg+"</li>"),$(".chatMessages").scrollTop($(".chatMessages ul").height()),0==e&&(f++,document.title="("+f+") ChangeDJ")}),$("body").on("click",".joinDJ",function(){socket.emit("join dj",userInfo.username),$(".leaveDJ").show(),$(".joinDJ").hide()}),$("body").on("click",".leaveDJ",function(){socket.emit("leave dj",userInfo.username),$(".leaveDJ").hide(),$(".joinDJ").show(),socket.emit("dj queue")}),socket.on("dj queue",function(){$.ajax({method:"GET",url:"/djqueue"}).done(function(a){b(a)})});var g=[],h=[];$(".searchInput").on("keyup",function(a){if(a.preventDefault(),13==a.which){g=[],h=[],$(".songSearches").empty();var b=$(".searchInput").val();c(b),$(".searchInput").val("")}}),$("body").on("click",".addSongToPlaylist",function(a){a.preventDefault();var b=$(this).parent(),c=$(this).parent().find(".searchedVideoTitle"),e=$(this).parent().find(".centerSearchIMG"),f=$(this).parent().find(".addSongToPlaylist"),i=$(this).parent().text().substring(1),j={username:userInfo.username,songname:i,songid:g[$(this).parent().index()],imgurl:h[$(this).parent().index()]};$.ajax({method:"POST",url:"/addsongtoplaylist",data:j}).done(function(a){b.css("background","#56C247"),e.css("margin","0px"),c.text("Added to playlist!"),f.hide(),d(a)})}),$("body").on("click",".removeSongBtn",function(){var a={username:userInfo.username,songid:$(this).data("songid")};$.ajax({method:"POST",url:"/removesong",data:a}).done(function(a){d(a)})}),socket.on("current dj",function(a){iAmDJ=userInfo.username==a,$(".djQueue ul li").css("background","#34509D"),$(".djQueue ul li").filter(function(){return $(this).text()===a}).css("background","#56C247")})}var mainPageCounter=0,socket,userInfo,userPlaylist,iAmDJ=!1;